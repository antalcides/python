"use strict";window.analytics=function(t){function e(){if(isUserSignedIn()){var e=getSignedInUsername();mixpanel.identify(e)}if(!t.IS_EMBEDPLOT_PAGE){var o=r(),n={};if("shareplot"===o.url_group){var a=t.location.pathname,s=2,l=a.substr(s,a.length).indexOf("/"),u=a.substr(s,l);n={shareplotOwner:u,visitingTheirOwnShareplot:getSignedInUsername()===u}}i("Page visit",n)}}function i(t,e,i){var r=i||{};if(r.embeddingDomain){var a=o();e["Embedding domain"]=a,e["Embedded on plot.ly"]=-1!=a.indexOf("plot.ly")}var s=n(e||{});console.log("Mixpanel",t,s),mixpanel.track(t,s)}function o(){if(t.location==t.parent.location)return t.location.host;var e=document.createElement("a");return e.href=document.referrer,e.host}function n(t){var e=r();e.plotlyUsername=getSignedInUsername();for(var i in t)e[i]=t[i];return e}function r(){function e(t){this.url=t,this.groupUrl=t}e.prototype.get=function(){return{url:this.url,url_group:this.groupUrl}},e.prototype.groupUrlByStart=function(t,e){for(var i in t)0===this.url.indexOf(t[i])&&(this.groupUrl=e)},e.prototype.shareplotOrProfile=function(){if(1===this.url.indexOf("~")||1===this.url.indexOf("%7")){var t=this.url.substr(1,this.url.length).indexOf("/");t=-1===t?-1:t+1,this.groupUrl=-1===t||t===this.url.length-1?"profile":"shareplot"}};var i=new e(t.location.pathname);i.shareplotOrProfile();var o=["/python","/matlab","/r","/nodejs","/julia","/matplotlib","/ggplot2"];i.groupUrlByStart(o,"apiDocs");var n=["/javascript-graphing-library","/rest","/streaming"];i.groupUrlByStart(n,"apiDocsDev");var r=["/how-to-sign-up-to-plotly","/add-data-to-the-plotly-grid","/how-to-share-and-print-plotly-graphs","/how-to-embed-plotly-graphs-in-websites","/how-to-create-a-line-of-best-fits","/how-to-make-a-line-graph-and-scatter-plot-online","/how-to-make-a-bar-chart-online","/how-to-make-an-area-chart-online","/how-to-make-a-histogram-online","/how-to-make-a-box-plot-online","/how-to-make-a-heatmap-online","/how-to-make-a-graph-with-error-bars-online","/how-to-make-a-graph-with-multiple-axes-online","/basic-statistics-tutorial","/histogram","/box-plot"];i.groupUrlByStart(r,"learnDocs");var a=["/create-charts-in-excel-with-plotly","/how-to-make-a-line-graph-and-scatter-plot-with-excel","/how-to-make-a-bar-chart-with-excel","/how-to-make-an-area-chart-with-excel","/how-to-make-a-histogram-with-excel","/how-to-make-a-box-plot-with-excel","/how-to-make-a-heatmap-with-excel","/how-to-make-a-graph-with-error-bars-with-excel","/how-to-make-a-graph-with-multiple-axes-with-excel"];i.groupUrlByStart(a,"excelDocs");var s=["/workshop","/arduino","/raspberry-pi","/electric-imp"];i.groupUrlByStart(s,"workshop");var l=["/product","/online-graphing-and-statistics-for-educators"];return i.groupUrlByStart(l,"product"),i.get()}function a(t,e,i){t&&mixpanel.get_distinct_id()!=t&&mixpanel.alias(t),mixpanel.identify(t),mixpanel.register_once({$email:e,$username:t,date_joined:i})}function s(t,e){var i="Experiment:"+t,o={};o[i]=e,mixpanel.register_once(o)}return"undefined"==typeof t.mixpanel&&(t.mixpanel={track:function(){console.log("skip mixpanel track()")},identify:function(){console.log("skip mixpanel identify()")},alias:function(){console.log("skip mixpanel alias()")},get_distinct_id:function(){console.log("skip mixpanel get_distinct_id()")},register_once:function(){console.log("skip mixpanel register_once()")}}),e(),{identifyUser:a,markExperiment:s,track:i}}(window,ENV),window.Bucketeer=function(t,e){var i={debug:!1,enabled:e.BUCKETEER_ENABLED},o={},n=function(t,e){analytics.markExperiment(t,e)},r=function(){var e=function(e){if(this.name=e.name,this.options=a.extend({buckets:null,onBucketed:null,qualify:null,sample:1},e),null===this.name||void 0===this.name)throw"A name for this experiment must be specified";if(null===this.options.bucket)throw"Buckets must be specified for this experiment";if(a.size(e.buckets)<2)throw"You must specify at least 2 buckets for a experiment";this.buckets=a.keys(this.options.buckets),o[this.name]=this;try{if(t.localStorage.setItem("bucketeer:testSetItem","Good To Go"),"Good To Go"!==t.localStorage.getItem("bucketeer:testSetItem"))throw new Error("localStorage failure");this.run()}catch(i){console.log("Disqualified for experiment, localStorage disabled")}};return e.prototype={run:function(){if(i.enabled){var e=t.location.hash;0==e.indexOf("#")&&(e=e.slice(1,e.length));for(var o=e.split("&"),r=0;r<o.length;r++){var s=o[r].split("="),l=s[0],u=s[1];this.name==l&&(a.log("Forcing experiment "+l+" into bucket "+u),this.setBucket(u))}var c=this.isQualified();if(null===c&&(!this.options.qualify||this.options.qualify())&&(c=Math.random()<=this.options.sample,this.setStoreVal("qualified",c?1:0)),c){if(this.getBucket())var h=this.getBucket();else{var p=1/a.size(this.options.buckets),f=Math.floor(Math.random()/p),h=a.keys(this.options.buckets)[f];this.setBucket(h)}n(this.name,h),this.options.onBucketed&&this.options.onBucketed.apply(this,[this.name,h]),this.options.buckets[h].onChosen&&this.options.buckets[h].onChosen()}}},isQualified:function(){return 1==this.getStoreVal("qualified")?!0:0==this.getStoreVal("qualified")?!1:null},inBucket:function(t){return this.isQualified()?this.getBucket()==t:!1},getBucket:function(){return this.isQualified()?this.getStoreVal("bucket"):null},setBucket:function(t){return-1==this.buckets.indexOf(t)?!1:(this.setStoreVal("bucket",t),!0)},setStoreVal:function(t,e){var i="bucketeer:"+this.name+":"+t;return localStorage.setItem(i,e)},getStoreVal:function(t){var e="bucketeer:"+this.name+":"+t;return localStorage.getItem(e)}},e}(),a={extend:function(t,e){for(var i in e)t[i]=e[i];return t},size:function(t){var e=0;for(var i in t)e+=1;return e},keys:function(t){var e=[];for(var i in t)e.push(i);return e},log:function(e){t.console&&i.debug&&(console.log?console.log(e):alert(e))}},s=function(t){var e=o[t];return e?e.isQualified():!1},l=function(t,e){var i=o[t];return i?i.inBucket(e):!1};return{Experiment:r,Options:i,isQualified:s,inBucket:l}}(window,ENV);